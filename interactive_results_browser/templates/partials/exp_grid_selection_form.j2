<form id="params" method="GET" action="">
    {% for k,v in exp_grid.items() %}
    <p style="display: inline-block">
        {% if isinstance(v, Iterable) %}
        <label for="[[k}}">{{k[9:]}}</label>
        <select id="{{k}}" multiple autocomplete="off" name="{{k}}">
            {% for v2 in v %}
            {% if isinstance(v2, enum) %}
            {% set v2_str = v2.name %}
            {% set v2_id = int(v2) %}
            {% elif isinstance(v2, tuple) %}
            {% set v2_str = _format_tuple(v2, config) %}
            {% set v2_id = _encrypt_tuple(v2, config) %}
            {% else %}
            {% set v2_str = str(v2) %}
            {% set v2_id = v2 %}
            {% endif %}

            {% if k in exp_grid_request_params.keys() and v2_id in exp_grid_request_params[k] %}
            <option value="{{v2_id}}" selected>{{v2_str}}</option>
            {% elif k not in exp_grid_request_params.keys() %}
            <option value="{{v2_id}}" selected>{{v2_str}}</option>
            {% else %}
            <option value="{{v2_id}}">{{v2_str}}</option>
            {% endif %}
            {% endfor %}
        </select>

        <script type="text/javascript">
            new TomSelect('#{{k}}', {
                plugins: {
                    'input_autogrow': {},
                    'checkbox_options': {},
                    'clear_button': { 'title': "Remove all selected options" }
                },
                persist: false,
                create: true,

            });
        </script>
        {% endif %}

    </p>
    {% endfor %}
    <input type="submit" value="Update" submit />
</form>